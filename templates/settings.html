{% extends "base.html" %}

{% block title %}Profile Settings - Fastcord{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center">
    <div class="max-w-md w-full space-y-8 p-8">
        <div class="text-center">
            <h2 class="text-3xl font-bold text-white mb-2">Profile settings</h2>
        </div>

        <div class="mt-6 space-y-6">
            <div class="mb-6">
                <h3 class="text-lg font-bold text-white mb-8">Account Settings</h3>
            </div>
            <div class="space-y-8">
                <!-- Made nickname change functional -->
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-base font-medium text-white">Nickname</h3>
                        <p class="text-gray-400 text-sm">Change your display name</p>
                    </div>
                    <button id="changeNicknameBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium px-6 py-3 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-950">
                        Change
                    </button>
                </div>
                <!-- Made avatar change functional -->
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-base font-medium text-white">Avatar</h3>
                        <p class="text-gray-400 text-sm">Change your avatar (URL)</p>
                    </div>
                    <button id="changeAvatarBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium px-6 py-3 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-950">
                        Change
                    </button>
                </div>
            </div>

            <div class="flex justify-center mt-12">
                <a href="/" class="text-gray-300 border border-gray-600 px-6 py-3 rounded-md hover:bg-gray-800 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-600 focus:ring-offset-2 focus:ring-offset-gray-950">
                    Back to Profile
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Added modals for nickname and avatar editing -->
<!-- Nickname Modal -->
<div id="nicknameModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-discord-darker rounded-lg p-6 w-96 max-w-md mx-4">
        <h3 class="text-xl font-bold text-white mb-4">Change Nickname</h3>
        <form id="nicknameForm">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-300 mb-2">New Nickname</label>
                <input type="text" id="nicknameInput" class="w-full bg-discord-darkest text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter new nickname" required>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" id="cancelNickname" class="px-4 py-2 text-gray-300 hover:text-white transition-colors">Cancel</button>
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md transition-colors">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Avatar Modal -->
<div id="avatarModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-discord-darker rounded-lg p-6 w-96 max-w-md mx-4">
        <h3 class="text-xl font-bold text-white mb-4">Change Avatar</h3>
        <form id="avatarForm">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-300 mb-2">Avatar URL</label>
                <input type="url" id="avatarInput" class="w-full bg-discord-darkest text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://example.com/avatar.jpg" required>
                <p class="text-xs text-gray-400 mt-1">Enter a direct link to your avatar image</p>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" id="cancelAvatar" class="px-4 py-2 text-gray-300 hover:text-white transition-colors">Cancel</button>
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md transition-colors">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const changeNicknameBtn = document.getElementById('changeNicknameBtn');
    const changeAvatarBtn = document.getElementById('changeAvatarBtn');
    const nicknameModal = document.getElementById('nicknameModal');
    const avatarModal = document.getElementById('avatarModal');
    const nicknameForm = document.getElementById('nicknameForm');
    const avatarForm = document.getElementById('avatarForm');
    const cancelNickname = document.getElementById('cancelNickname');
    const cancelAvatar = document.getElementById('cancelAvatar');

    // Show nickname modal
    changeNicknameBtn.addEventListener('click', function() {
        nicknameModal.classList.remove('hidden');
        nicknameModal.classList.add('flex');
    });

    // Show avatar modal
    changeAvatarBtn.addEventListener('click', function() {
        avatarModal.classList.remove('hidden');
        avatarModal.classList.add('flex');
    });

    // Hide modals
    cancelNickname.addEventListener('click', hideNicknameModal);
    cancelAvatar.addEventListener('click', hideAvatarModal);

    function hideNicknameModal() {
        nicknameModal.classList.add('hidden');
        nicknameModal.classList.remove('flex');
    }

    function hideAvatarModal() {
        avatarModal.classList.add('hidden');
        avatarModal.classList.remove('flex');
    }

    // Handle nickname form submission
    nicknameForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const nickname = document.getElementById('nicknameInput').value.trim();

        if (!nickname) return;

        try {
            const formData = new FormData();
            formData.append('nickname', nickname);

            const response = await fetch('/api/update-nickname', {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                alert('Nickname updated successfully!');
                hideNicknameModal();
                location.reload(); // Refresh to show updated nickname
            } else {
                const error = await response.json();
                alert('Error: ' + (error.detail || 'Failed to update nickname'));
            }
        } catch (error) {
            console.error('Error updating nickname:', error);
            alert('An error occurred while updating nickname');
        }
    });

    // Handle avatar form submission
    avatarForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const avatarUrl = document.getElementById('avatarInput').value.trim();

        if (!avatarUrl) return;

        try {
            const formData = new FormData();
            formData.append('avatar_url', avatarUrl);

            const response = await fetch('/api/update-avatar', {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                alert('Avatar updated successfully!');
                hideAvatarModal();
                location.reload(); // Refresh to show updated avatar
            } else {
                const error = await response.json();
                alert('Error: ' + (error.detail || 'Failed to update avatar'));
            }
        } catch (error) {
            console.error('Error updating avatar:', error);
            alert('An error occurred while updating avatar');
        }
    });

    // Close modals when clicking outside
    nicknameModal.addEventListener('click', function(e) {
        if (e.target === nicknameModal) {
            hideNicknameModal();
        }
    });

    avatarModal.addEventListener('click', function(e) {
        if (e.target === avatarModal) {
            hideAvatarModal();
        }
    });
});
</script>
{% endblock %}
